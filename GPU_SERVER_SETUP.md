# GPU Server κµ¬μ„± κ°€μ΄λ“ (κ°„λ‹¨ν• REST API λ°©μ‹)

Pipe Inspector Electron μ•±μ GPU μ„λ²„ μ•„ν‚¤ν…μ² - REST API κΈ°λ°

## π—οΈ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  ν΄λΌμ΄μ–ΈνΈ PC (No GPU)  β”‚
β”‚                         β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ Electron App (UI)β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚           β”‚ HTTP        β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ Flask Proxy      β”‚   β”‚
β”‚  β”‚ (Port 5001)      β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
            β”‚
            β”‚ HTTP
            β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚    GPU μ„λ²„              β”‚
β”‚                         β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚   Flask API      β”‚   β”‚
β”‚  β”‚   (Port 5002)    β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚           β”‚             β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚  Grounded-SAM    β”‚   β”‚
β”‚  β”‚  (GPU Tasks)     β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π€ μ„¤μΉ λ° μ‹¤ν–‰

### GPU μ„λ²„ (ν• λ²λ§ μ„¤μ •)

**1λ‹¨κ³„: GPU μ„λ²„μ—μ„ API μ‹¤ν–‰**

```bash
cd /home/ppak/pipe-inspector-electron

# GPU μ„λ²„ μ‹¤ν–‰
python3 gpu-server/api.py
```

μ¶λ ¥:
```
π€ Starting GPU Server API...
π“΅ API Server: http://0.0.0.0:5002
π® GPU Tasks: Enabled
```

### λ΅μ»¬ λ¨λ“ (GPUκ°€ μλ” PCμ—μ„ μ§μ ‘ μ‹¤ν–‰)

**μ „μ²΄ μ•± μ‹μ‘:**

```bash
# GPU μ„λ²„λ΅ μ‹¤ν–‰
python3 gpu-server/api.py

# λ‹¤λ¥Έ ν„°λ―Έλ„μ—μ„
npm run start:all
```

### μ›κ²© λ¨λ“ (ν΄λΌμ΄μ–ΈνΈ PC β†’ GPU μ„λ²„)

**GPU μ„λ²„μ—μ„:**
```bash
python3 gpu-server/api.py
```

**ν΄λΌμ΄μ–ΈνΈ PCμ—μ„:**
```bash
# GPU μ„λ²„ URL μ„¤μ •
export GPU_SERVER_URL=http://192.168.0.100:5002

# ν”„λ΅μ‹ λ°±μ—”λ“ μ‹¤ν–‰
python3 backend_proxy.py

# Electron μ•± μ‹¤ν–‰
npm start
```

## π“ λ°±μ—”λ“ λ²„μ „ λΉ„κµ

| νμΌ | λ¨λ“ | μ„¤λ… | μ‚¬μ© μ‹λ‚λ¦¬μ¤ |
|------|------|------|--------------|
| `backend_local.py` | λ΅μ»¬ | Grounded-SAM μ§μ ‘ νΈμ¶ | GPU μλ” PC |
| `backend_proxy.py` | ν”„λ΅μ‹ | GPU μ„λ²„λ΅ μ „λ‹¬ | β­ ν΄λΌμ΄μ–ΈνΈ PC (No GPU) |
| `backend.py` (Quart/MCP) | MCP | λ³µμ΅ν•¨, μ‚¬μ© μ• ν•¨ | - |
| `gpu-server/api.py` | GPU μ„λ²„ | Grounded-SAM μ‹¤ν–‰ | β­ GPU μ„λ²„ |

## π§ ν…μ¤νΈ

### GPU μ„λ²„ ν…μ¤νΈ

```bash
# ν—¬μ¤ μ²΄ν¬
curl http://localhost:5002/api/health

# ν”„λ΅μ νΈ λ©λ΅
curl http://localhost:5002/api/projects
```

### ν΄λΌμ΄μ–ΈνΈ ν…μ¤νΈ

```bash
# ν—¬μ¤ μ²΄ν¬
curl http://localhost:5001/api/health

# ν”„λ΅μ νΈ λ©λ΅
curl http://localhost:5001/api/projects
```

## π”§ μ„¤μ •

### ν™κ²½ λ³€μ

**ν΄λΌμ΄μ–ΈνΈ PC (`backend_proxy.py`):**
```bash
export GPU_SERVER_URL=http://192.168.0.100:5002
```

**GPU μ„λ²„ IP ν™•μΈ:**
```bash
# GPU μ„λ²„μ—μ„ μ‹¤ν–‰
hostname -I
```

## π“ API μ—”λ“ν¬μΈνΈ

λ¨λ“  μ—”λ“ν¬μΈνΈλ” GPU μ„λ²„μ™€ ν”„λ΅μ‹μ—μ„ λ™μΌν•©λ‹λ‹¤:

```
GET  /api/health                              - ν—¬μ¤ μ²΄ν¬
GET  /api/projects                            - ν”„λ΅μ νΈ λ©λ΅
POST /api/projects                            - ν”„λ΅μ νΈ μƒμ„±
GET  /api/projects/<id>                       - ν”„λ΅μ νΈ μ΅°ν
POST /api/projects/<id>/videos                - λΉ„λ””μ¤ μ¶”κ°€
DELETE /api/projects/<id>/videos/<video_id>   - λΉ„λ””μ¤ μ κ±°
```

## π”„ μ „ν™ κ°€μ΄λ“

### λ΅μ»¬ β†’ μ›κ²© μ „ν™

**1λ‹¨κ³„: GPU μ„λ²„ μ‹μ‘**
```bash
# GPU μ„λ²„μ—μ„
python3 gpu-server/api.py
```

**2λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈ PCμ—μ„ ν”„λ΅μ‹ λ¨λ“λ΅ μ „ν™**
```bash
# backend_local.py λ€μ‹  backend_proxy.py μ‚¬μ©
export GPU_SERVER_URL=http://<GPU_SERVER_IP>:5002
python3 backend_proxy.py
```

**3λ‹¨κ³„: Electron μ•± μ‹¤ν–‰**
```bash
npm start
```

## π› νΈλ¬λΈ”μν…

### GPU μ„λ²„ μ—°κ²° μ‹¤ν¨

**μ¦μƒ**: `Cannot connect to GPU server`

**ν•΄κ²°:**
1. GPU μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈ: `curl http://<GPU_IP>:5002/api/health`
2. λ°©ν™”λ²½ ν™•μΈ: `sudo ufw allow 5002`
3. GPU_SERVER_URL ν™κ²½ λ³€μ ν™•μΈ

### ν”„λ΅μ νΈκ°€ λ³΄μ΄μ§€ μ•μ

**ν™•μΈ:**
```bash
# GPU μ„λ²„μ—μ„
ls -la /home/ppak/SynologyDrive/ykpark/linux_devel/ground_sam/Grounded-Segment-Anything/projects/
```

## π’΅ μ¥μ 

β… **κ°„λ‹¨ν•¨**: MCP λ³µμ΅λ„ μ—†μ
β… **μ•μ •μ„±**: κ²€μ¦λ HTTP/REST API
β… **λ””λ²„κΉ…**: curlλ΅ μ‰½κ² ν…μ¤νΈ
β… **ν™•μ¥μ„±**: μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈ β†’ ν•λ‚μ GPU μ„λ²„
β… **μ μ—°μ„±**: λ΅μ»¬/μ›κ²© λ¨λ“ μ‰½κ² μ „ν™

## π“ λ‹¤μ λ‹¨κ³„

1. **μΈμ¦ μ¶”κ°€**: API ν‚¤ κΈ°λ° μΈμ¦
2. **GPU μ‘μ—… ν**: λ™μ‹ μ”μ²­ μ²λ¦¬
3. **μ§„ν–‰ μƒνƒ**: WebSocketμΌλ΅ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
4. **μΊμ‹±**: Redisλ΅ κ²°κ³Ό μΊμ‹±
